---
title: "VID - Travail Pratique 2"
date: "2023"
author: "Hugo Huart"
fontsize: 12pt
output: pdf_document
toc: yes
toc-title: "Table des matières"
toc-depth: 2
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \setlength{\headheight}{32pt}
  - \fancyhead[LE,LO]{Hugo Huart - VID - Travail Pratique 2}
  - \usepackage{geometry}
  - \geometry{top=2cm,left=2cm,bottom=2cm,right=2cm}
---

\pagebreak
# Introduction

introduction introduction introduction introduction introduction 

## Chargement des librairies

```{r}
library("ggplot2")
library("ggResidpanel")
library("ggrepel")
```

\pagebreak
# Exercice 1

Cet exercice à pour but d'appliquer un modèle de régression linéaire sur des
données comprenant la taille moyenne en centimètres (cm) d’un groupe d’enfants
de Kalama, village en Egypte, mesurée chaque mois entre le 18-ième
et le 29-ième mois.

Chargement des données dans la variable `kalama`:

```{r}
kalama<-read.table("data/kalama.txt", header=T)
```

## 1 - a)

Calcul du coefficient de corrélation entre la taille et l'âge:

```{r}
cor(kalama$age, kalama$taille)
```

## 1 - b)

Affichage du graphique en nuage de points des valeurs taille versus âge:

```{r fig.align='center', fig.width=4, fig.height=4}
ggplot(kalama, aes(x=age, y=taille)) +
  geom_point() +
  theme_bw()
```

\pagebreak
## 1 - c)

Estimation des coefficients $\beta_0$ (`intercept`) et $\beta_1$ (`slope`):

```{r}
kalama.lm<-lm(taille~age, data=kalama)
kalama.coef<-data.frame(intercept=coef(kalama.lm)[1], slope=coef(kalama.lm)[2])
```

## 1 - d)

Affichage du graphique précédent modifié avec la droite des moindres carrés en
rouge:

```{r fig.align='center', fig.width=6, fig.height=5}
ggplot(data=kalama, aes(x=age, y=taille)) +
  geom_point() +
  geom_abline(data=kalama.coef, aes(intercept=intercept, slope=slope),
              colour="red", linetype=2) +
  theme_bw()
```

## 1 - e)

On peut estimer la variance des erreurs en calculant la variance des résidus:

```{r}
var(resid(kalama.lm))
```

## 1 - f)

Estimation du coefficient de détermination:

```{r}
summary(kalama.lm)$r.squared
```

Étant donné qu'il s'agit d'une régression linéaire simple, on peut également
calculer le coefficient de détermination avec le carré de celui de corrélation:

```{r}
cor(kalama$age, kalama$taille)^2
```

## 1 - g)

Affichage d'un diagnostic du modèle, à l'aide de la libraire `ggResidpanel`:

```{r, fig.align='center', fig.width=8, fig.height=6}
resid_panel(kalama.lm, plots="all")
```

## 1 - h)

On constate dans le graphique des résidus du point précédent que ces derniers
ont des valeurs plutôt faibles et sont répartis de façon homogène;
le modèle est donc assez bon en ce sens.

De plus, le graphique du point **d)** permet de constater facilement
l'alignement des valeurs et le faible écart par rapport
à la droite de régression. La variance des erreurs estimée au point **e)** est
elle aussi très faible.

## 1 - i)

En regardant le résumé du modèle de régression linéaire: 

```{r}
summary(kalama.lm)
```

On constate que la _p-value_ de la pente du modèle
(à la ligne `age` et la colonne `Pr(>|t|)` du tableau `Coefficients`)
est bien inférieure à 5%, ce qui est significatif.

\pagebreak
# Exercice 2

Cet exercice à pour but d'analyser le Produit National Brut par habitant (PNB)
et la mortalité infantile de 14 pays européens.

## 2 - a)

Chargement des données dans l'objet `mortalite.pnb`:

```{r}
mortalite.pnb <- data.frame(pays=c("Allemagne RFA","Autriche","Belgique","Danemark","Espagne",
"France","Grèce","Irlande","Italie","Luxembourg","Pays-Bas",
"Portugal","Royaume-Uni","Suisse"),
PNB=c(190, 128, 180, 212, 56, 192, 68, 98, 110, 197, 155, 40, 181, 233),
mortalite=c(24, 28, 24, 19, 37, 22, 34, 25, 36, 24, 14, 65, 20, 18))
print(mortalite.pnb)
```

## 2 - b)

Affichage du résumé des variables: 

```{r}
summary(mortalite.pnb)
```

\pagebreak
## 2 - c)

On commence par appliquer un modèle de régression linéaire sur nos données:

```{r}
mortalite.pnb.lm<-lm(mortalite~PNB, data=mortalite.pnb)
mortalite.pnb.coef<-data.frame(intercept=coef(mortalite.pnb.lm)[1],
                               slope=coef(mortalite.pnb.lm)[2])
```

Affichage d'un nuage de point représentant la mortalité infantile _(x)_ en
fonction du produit national brut _(y)_:

```{r fig.align='center', fig.width=6, fig.height=5.5}
ggplot(data=mortalite.pnb, aes(x=PNB, y=mortalite, label=pays)) + 
  geom_point(colour="slateblue4") +
  geom_text_repel(colour="slateblue4") +
  geom_abline(data=mortalite.pnb.coef, aes(slope=slope, intercept=intercept),
              colour="blue") +
  labs(x="PNB par habitant", y="mortalité infantile",
       title="PNB et mortalité infantile") + 
  theme_minimal()
```

Le Portugal est de loin le pays le plus éloigné de la tendance générale. Dans
une moindre mesure, les Pays-Bas et l'Irlande se démarquent également, bien
que plus légèrement.

## 2 - d)

En prenant les valeurs suivantes du modèle:

```{r}
mortalite.pnb.lm
```

On peut écrire l'équation $y = \beta_0x + \beta_1 + e$ où $e$ correspond à
l'erreur,  $\beta_0$ à la valeur de `(Intercept)` ($51.0133$)
et $\beta_1$ à la valeur de `(PNB)` ($-0.1589$).

## 2 - e)

Calcul du coefficient de corrélation $r$:

```{r}
mortalite.pnb.cor<-cor(mortalite.pnb$PNB, mortalite.pnb$mortalite)
mortalite.pnb.cor
```

## 2 - f)

Calcul du coefficient de détermination $R^2$ égal à $r^2$:

```{r}
mortalite.pnb.cor^2
```

\pagebreak
## 2 - g)

Affichage des 4 graphiques aidant à la vérification des hypothèses inhérentes
au modèle, c'est-à-dire:

1. La linéarité de la relation;
2. la nullité de l'espérance des erreurs et leur variance constante;
3. La normalité des variables aléatoires erreurs.

```{r, fig.align='center', fig.width=5, fig.height=5}
par(mfrow=c(2, 2))
plot(mortalite.pnb.lm)
```

Dans ces graphiques, **R** a relevé les 3 pays aux valeurs
les plus anormales identifiées précédemment en affichant leur numéro respectifs.
Il s'agit de l'Irlande (**8**), des Pays-Bas (**11**) et du Portugal (**12**).

Ci-dessous se trouvent les informations relevées par chaque graphique:

### Nuage de points des résidus (`Residuals vs Fitted`)

On constate une variabilité assez proche autour de 0 malgré une légère tendance
à la baisse. Le modèle reste assez satisfaisant mais pas totalement
idéal en ce sens. L'hypothèse d'espérance des erreurs nulle
semble être vérifiée.

### Nuage de points de la racine carrée de la valeur absolue des résidus contre les valeurs ajustées (`Scale-Location`)

Hormis les valeurs plutôt atypiques déjà connues, les valeurs ont toutes une
variance assez semblable. L'hypothèse de variance constante est vérifiée.

### Graphique des résidus observés standardisés contre les résidus théoriques (`Q-Q Residuals`)

Hormis la valeur du Portugal, les valeurs restent proches de la droite.
L'hypothèse de normalité des erreurs est vérifiée.

### Graphique représentant la distance de Cook (`Residuals vs Leverage`)

On retrouve la valeur du Portugal au delà des traitillés, ce qui confirme
encore une fois son statut de valeur atypique.

## 2 - h)

Prédiction de la mortalité infantile pour un PNB de 100.

```{r}
xnew <- matrix(c(100), nrow=1)
colnames(xnew) <- c("PNB")
xnew <- as.data.frame(xnew)
predict(mortalite.pnb.lm, xnew, interval="pred")
```


La prédiction nous donne une valeur d'environ $35.12$.

## 2 - i)

Le nouveau modèle possédant un coefficient de détermination de $0.74$ est
sensiblement meilleur au modèle existant, possédant un coefficient
d'environ $0.61$. Celui du nouveau modèle étant plus proche de 1, on peut
considérer ce dernier comme étant sensiblement meilleur.

# Exercice 3

Cet exercice a pour but d'analyser la relation entre la taille de la portée,
le poids du corps ainsi que le poids du cerveau d'un échantillon de 20 souris.

On charge les données nécessaires dans un objet `litters`:

```{r}

```





